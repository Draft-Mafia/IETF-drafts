<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc toc='yes'?>
<?rfc tocdepth="3"?>
<?rfc compact="yes"?>
<?rfc tocdepth="yes"?>
<?rfc tocindent="yes"?>
<?rfc symrefs="yes"?>
<?rfc sortrefs="yes"?>
<?rfc comments="yes"?>
<?rfc inline ="yes"?>
<?rfc subcompact="no"?>
<?rfc tocompact="yes"?>
<rfc category="std" docName="draft-reddy-tram-turn-flowdata-00"
     ipr="trust200902">
  <front>
    <title abbrev="TURN flowdata">TURN extension to convey flow characteristics</title>
  <author fullname="Tirumaleswar Reddy" initials="T." surname="Reddy">
      <organization>Cisco Systems</organization>

      <address>
        <postal>
          <street>Cessna Business Park, Varthur Hobli</street>

          <street>Sarjapur Marathalli Outer Ring Road</street>

          <city>Bangalore</city>

          <region>Karnataka</region>

          <code>560103</code>

          <country>India</country>
        </postal>

        <email>tireddy@cisco.com</email>
      </address>
    </author>
    
    <author fullname="Ram Mohan Ravindranath" initials="R"
            surname="Ravindranath">
      <organization>Cisco Systems</organization>

      <address>
        <postal>
          <street>Cessna Business Park</street>

          <street>Sarjapur-Marathahalli Outer Ring Road</street>

          <city>Bangalore</city>

          <region>Karnataka</region>

          <code>560103</code>

          <country>India</country>
        </postal>

        <email>rmohanr@cisco.com</email>
      </address>
    </author>
<author fullname="Dan Wing" initials="D" surname="Wing">
      <organization>Cisco Systems</organization>

      <address>
        <postal>
          <street>821 Alder Drive</street>

          <city>Milpitas</city>

          <region>California</region>

          <code>95035</code>

          <country>USA</country>
        </postal>

        <email>dwing@cisco.com</email>
      </address>
    </author>

    
    <author fullname="Paal-Erik Martinsen" initials="P.E" surname="Martinsen">
      <organization abbrev="Cisco">Cisco Systems, Inc.</organization>

      <address>
        <postal>
          <street>Philip Pedersens Vei 22</street>

          <city>Lysaker</city>

          <region>Akershus</region>

          <code>1325</code>

          <country>Norway</country>
        </postal>

        <email>palmarti@cisco.com</email>
      </address>
    </author>
   <date />

    <area>RAI</area>

    <workgroup>TRAM</workgroup>

    <abstract>
   <t>This document defines a mechanism for a TURN client to signal flow
   characteristics to a TURN server, and the TURN server in turn uses this to prioritize 
   the channels accordingly.  The mechanism defines a
   new comprehensive optional STUN attribute that MAY be carried in ChannelBind STUN 
   message to convey the flowdata.</t>
    
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>TURN <xref target="RFC5245"></xref> is a protocol that is often used to improve 
      the connectivity of P2P applications.  By providing a cloud-based relay
   service, TURN ensures that a connection can be established even when
   one or both sides is incapable of a direct P2P connection.  TURN server is a building 
   block to support interactive, real-time communication using audio, video, 
   collaboration, games, etc., between two peer web browsers using the Web Real-Time 
   communication (WebRTC) <xref target="I-D.ietf-rtcweb-overview"></xref>
    framework.  The use-case explained in "Simple Video Communication Service, 
    enterprise aspects" (Section 3.2.5 of <xref target="I-D.ietf-rtcweb-use-cases-and-requirements"></xref>)
   refers to deploying a TURN[RFC5766] server in the DMZ to audit all
   media sessions from inside an Enterprise premises to any external
   peer. </t>
   
    <t>When TURN is used for all media sessions it can result in becoming a 
   bottle neck and create problems like latency, delay e.t.c. So there is a need to have
   the server to prioritise flows. This draft propose a method by which a TURN client can 
   signal flow characteristics to a TURN server, and the TURN server in turn uses this to 
   prioritise the channels accordingly</t>

      <t>When a session is first established, WebRTC implementations
      are required to perform STUN connectivity checks as part
      of <xref target="RFC5245">ICE</xref>. That initial consent is
      not described further in this document and it is assumed that
      ICE is being used for that initial consent. </t>

      <t>Related to consent is loss of connectivity ("liveness").
      Many applications want notification of
      connection loss to take appropriate actions (e.g., alert the
      user, try switching to a different interface).
      </t>

      <t>This document describes a new STUN usage with a request and
      response messages which verifies the remote peer's consent to
      receive traffic, and can also detect loss of liveness.</t>

    </section>

    <section anchor="sec-term" title="Terminology">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <xref
      target="RFC2119"></xref>.</t>

      <t>The reader is expected to be aware of STUN<xref
      target="RFC5389"></xref> and TURN<xref
      target="RFC5766"></xref> concepts and terminology.</t>
    </section>

    <section title="Solution Overview">
      <t>A new comprehensive optional STUN attribute called TURN-FLOWDATA is described as
      part of this draft. If a TURN Client wishes to indicate its flow characteristics it 
      MUST insert this attribute in ChannelBind STUN method only.
      Other specifications may extend to have this attribute in other STUN methods.</t>
      
      <section title="Usage">
       <t>A client that needs TURN service and also wishes to have the TURN server 
       prioritise its flow MAY use this attribute. This attribute if used MUST be sent
       only in the ChannelBind STUN method. Since the client discloses its flow characteristics
       via the flowdata attribute it is  RECOMMENDED the client and TURN server authorise each
       other during the Allocate STUN request/response. The endpoint MAY use the authentication
       methods described in  <xref target="RFC5766"></xref> or use the Third party Authorization
       mechanism described in <xref target="I-D.reddy-tram-turn-third-party-authz"/>.
       </t>
      </section>
      
      <section title="Generating a ChannelBind message with TURN-FLOWDATA attribute">
      <t>After the Allocate request/response a relayed transport address granted to a client
      through an Allocate request, along with related state, such as permissions and 
      expiration timers. A client can then choose to use either Send and Data STUN methods 
      or Channels to exchange data with its peer. For bandwidth intensive applications like
      video, webRTC a Send indication or Data indication(which adds 36 bytes overhead) can
      substantially increase the bandwidth required between the client and the server. 
      Hence Channels are commonly used for bandwidth intensive applications to exchange data.
      In this specification we will focus on indicating Flowdata only in Channel messages.
      </t>
      
      <t>When sending a ChannelBind request to the server a Client includes CHANNEL-NUMBER 
      and an XOR-PEER-ADDRESS(that represents peer transport address) attribute. Along with 
      this TURN-FLOWDATA attribute will be added. The new attribute will have a type(TBD) and
      length of 4 bytes. It will indicate Delay, Loss and Jitter for both Upstream and Downstream
      which the client desires to have. </t>
      
      <t>When ChannelBind is refreshed (every 10 mins as per <xref target="RFC5766"></xref>),
      the client MUST add TURN-FLOWDATA attribute in each refresh.
      
      TBD: Is it really needed to indicate Flow characteristics each time in refresh message?
      Alternatively a Client can just send normal ChannelBind and attach FLOWDATA attribute
      only when the flow characteristics changes</t>
      
      <t>TBD: What if the Delay, Loss or Jitter requirements of Client changes mid call and before
      ChannelBind expires ? Does the client has to wait till ChannelBind expires before it
      indicates new values ?</t>
      </section>
      
      <section title="Processing a Request with TURN-FLOWDATA attribute">
      <t> When a TURN Server receives a ChannelBind message it will validate the CHANNEL-NUMBER
      and XOR-PEER-ADDRESS attributes as per <xref target="RFC5766"></xref>.  If the message 
      has a TURN-FLOWDATA attribute the Server will determine if it can provide the desired
      Upstream/Downstream Delay, Loss and Jitter as requested by the client. If the Server
      can provide the same it will respond to the ChannelBind as per the <xref target="RFC5766"></xref>.
      The TURN server then will provide the requested flow characteristics for that flow towards
      the peer identified by XOR-PEER-ADDRESS.
      </t>
      
      <t>If the Server cannot provide the desired flow characteristics then it will send a
      response a 508 (Insufficient Capacity) error
      
      TBD: Do we need a new error code ?
      </t> 
      <t>TBD: What should be the Server behaviour if it receives a refresh ChannelBind with no
      TURN-FLOWDATA attribute ? What should be server behaviour if it receives refresh
      ChanelBind message with new values in TURN-FLOWDATA ?</t>
      </section>
      
    </section>
    
    <section title="TURN-FLOWDATA format">    
     <t> This section describes the format of the new STUN attribute TURN-FLOWDATA. </t>
     
     <t><figure anchor="Figure1" title="FW-FLOWDATA Attribute">
          <artwork align="left"><![CDATA[
              The FLOWDATA option request has the following format.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Attribute Type (TBD)      |          Length (4)               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | uDT | uLT | uJT |   RSVD1     | dDT | dLT | dJT |    RSVD2    |
   +---------------------------------------------------------------+
   
          ]]></artwork></figure></t>
          
    <t><list style="hanging">
          <t hangText="uDT:">Upstream Delay Tolerance, 0=no information available, 1=very
      low, 2=low, 3=medium, 4=high.</t>

          <t hangText="uLT:"> Upstream Loss Tolerance, 0=no information available, 1=very
      low, 2=low, 3=medium, 4=high.</t>

          <t hangText="uJT:">Upstream Jitter Tolerance, 0=no information available, 1=very
      low, 2=low, 3=medium, 4=high.</t>

          <t hangText="RSVD1:">Reserved (7 bits), MUST be ignored on reception and MUST be 0
      on transmission.</t>

          <t hangText="dDT:">Downstream Delay Tolerance, 0=no information available, 1=very
      low, 2=low, 3=medium, 4=high.</t>

          <t hangText="dLT:">Downstream Loss Tolerance, 0=no information available, 1=very
      low, 2=low, 3=medium, 4=high.</t>
          
          <t hangText="dJT:">Downstream Jitter Tolerance, 0=no information available, 1=very
      low, 2=low, 3=medium, 4=high.</t>
          
          <t hangText="RSVD2:">Reserved (7 bits), MUST be ignored on reception and MUST be 0
      on transmission.</t>
      </list></t>
     
    </section>


    <section title="Security Considerations">

      <t>On some networks, only certain users or certain applications are
   authorized to signal the priority of a flow.  This authorization can
   be achieved with TURN third party authentication<xref target="I-D.reddy-tram-turn-third-party-authz"/>.</t>

   <t>For STUN requests or responses that are not sent using TLS or DTLS
   transport, the TURN-FLOWDATA attribute contains information to an eavesdropper who
   could use it to learn about the nature of a session to be established.  For example,
   they might be able to deduce from the bandwidth requested that the
   session is likely to be audio only, or audio and video.</t>
   
   <t>The TURN-FLOWDATA attribute will have integrity protection from the MESSAGE-
   INTEGRITY attribute and hence a eavesdropper may not be able to tamper it.</t>

    </section>

    <section anchor="sec.iana-considerations" title="IANA Considerations">
      <t>This document does not require any action from IANA.</t>
    </section>

    <section title="Acknowledgement">
      <t>TBD. </t>
    </section>
    
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="reference.RFC.2119"?>
      <?rfc include="reference.RFC.5245"?>
      <?rfc include="reference.RFC.5766"?>

      <?rfc include="reference.RFC.5389"?>
      
       <?rfc include="reference.I-D.reddy-tram-turn-third-party-authz"?>

      <?rfc include="reference.I-D.ietf-rtcweb-use-cases-and-requirements"?>
      
      <?rfc include="reference.I-D.ietf-rtcweb-overview"?>
      
    </references>

  </back>
</rfc>
