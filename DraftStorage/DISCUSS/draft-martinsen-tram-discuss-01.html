<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Differentiated prIorities and Status Code-points Using Stun Signalling (DISCUSS)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 General Usage"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Network Processing"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Packet Processing by Network Device"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Interaction with DSCP"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Interaction with ICE"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Multiplexed Streams"/>
<link href="#rfc.section.6" rel="Chapter" title="6 New STUN attributes"/>
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 STREAM-TYPE"/>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 BANDWIDTH-USAGE"/>
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 STREAM-PRIORITY"/>
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 NETWORK-STATUS"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="8 References"/>
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informational References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.7 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Martinsen, P. and H. Wildfeuer" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-martinsen-tram-discuss-01" />
  <meta name="dct.issued" scheme="ISO8601" content="2014-4-2" />
  <meta name="dct.abstract" content="This draft describes a mechanism for information exchange between an application and the network.  The information provided from the application to the network MAY be used by a network element in the path to modify its behavior to improve application quality of experience (QoE).  Likewise, the information provided by the network to the application MAY be used by the application to modify its behavior to optimize for QoE.  " />
  <meta name="description" content="This draft describes a mechanism for information exchange between an application and the network.  The information provided from the application to the network MAY be used by a network element in the path to modify its behavior to improve application quality of experience (QoE).  Likewise, the information provided by the network to the application MAY be used by the application to modify its behavior to optimize for QoE.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">TRAM</td>
  <td class="right">P. Martinsen</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">H. Wildfeuer</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">Cisco</td>
</tr>
<tr>
  <td class="left">Expires: October 4, 2014</td>
  <td class="right">April 2, 2014</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Differentiated prIorities and Status Code-points Using Stun Signalling (DISCUSS)<br />
  <span class="filename">draft-martinsen-tram-discuss-01</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This draft describes a mechanism for information exchange between an application and the network.  The information provided from the application to the network MAY be used by a network element in the path to modify its behavior to improve application quality of experience (QoE).  Likewise, the information provided by the network to the application MAY be used by the application to modify its behavior to optimize for QoE.  </p>
<h1>
  <a>Requirements Language</a>
</h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 4, 2014.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2014 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">General Usage</a></li>
<li>3.   <a href="#rfc.section.3">Network Processing</a></li>
<li>3.1.   <a href="#rfc.section.3.1">Packet Processing by Network Device</a></li>
<li>3.2.   <a href="#rfc.section.3.2">Interaction with DSCP</a></li>
<li>4.   <a href="#rfc.section.4">Interaction with ICE</a></li>
<li>5.   <a href="#rfc.section.5">Multiplexed Streams</a></li>
<li>6.   <a href="#rfc.section.6">New STUN attributes</a></li>
<li>6.1.   <a href="#rfc.section.6.1">STREAM-TYPE</a></li>
<li>6.2.   <a href="#rfc.section.6.2">BANDWIDTH-USAGE</a></li>
<li>6.3.   <a href="#rfc.section.6.3">STREAM-PRIORITY</a></li>
<li>6.4.   <a href="#rfc.section.6.4">NETWORK-STATUS</a></li>
<li>7.   <a href="#rfc.section.7">Acknowledgements</a></li>
<li>8.   <a href="#rfc.references">References</a></li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>8.2.   <a href="#rfc.references.2">Informational References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">In the context of Content, Mobile, Fixed Service, Service Providers, Enterprise and Private networks have a need to prioritize packet flows end-to-end. These flows are often dynamic, time-bound, encrypted, peer-to-peer, possibly asymmetric, and might have different priorities depending on network conditions, direction, time of the day, dynamic user preferences and other factors. These factors may be time variant, and thus need to be signalled. Moreover, in many cases of peer-to-peer communication, flow information is known only to the endpoint. These considerations, coupled with the trend to use encryption for browser-to-browser communication <a href="#I-D.ietf-rtcweb-security-arch">[I-D.ietf-rtcweb-security-arch]</a>, imply that access lists, deep packet inspection and other static prioritization methods cannot be employed successfully to prioritize packet flows.  </p>
<p id="rfc.section.1.p.2">There is a need for a solution that is easy for the application developer to use. That means consistent behaviour on all supported platforms and preferably without need of administrative privileges to set and read values. The solution also needs to be able to cross administrative domains without the risk of being rewritten.  <a id="Q1" class="info">[Q1]<span class="info">palmarti: This draft will only offer tamper detection of some of the values. Further discussion regarding the incentive to lie is needed.  </span></a> </p>
<p id="rfc.section.1.p.3">This draft describes how these problems can be solved by defining a few strictly defined STUN <a href="#RFC5389">[RFC5389]</a> attributes which can be added to any STUN message the client wants to send. STUN messages are typically sent during the ICE <a href="#RFC5245">[RFC5245]</a> connectivity check phase when the media session is established, or when keep-alive STUN messages are sent after the session is established. The application is not limited to those two scenarios, if some communication between application and network is needed it can choose to do so at any time.  </p>
<p id="rfc.section.1.p.4">Devices on the media path can use the information in the STUN attributes to prioritize the flow, perform traffic engineering, provide network analytics or as a gateway to existing methods for prioritizing flows (DSCP <a href="#RFC2474">[RFC2474]</a>). Applications can use information in network status attribute to influence rate stating points or rate adaption mechanisms.  </p>
<p id="rfc.section.1.p.5">The functionality described here is referred to as DISCUSS. Due to the security implications described in <a href="#I-D.thomson-mmusic-ice-webrtc">[I-D.thomson-mmusic-ice-webrtc]</a> where large STUN packet are used amplify an attack, keeping the added STUN attributes is an important design consideration. To avoid unwanted information leakage the new defined STUN attributes are strictly defined in this draft.  </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> General Usage</h1>
<p id="rfc.section.2.p.1">This draft defines several attributes that can be added to a STUN message; STREAM-TYPE, BANDWIDTH-USAGE, STREAM-PRIORITY and NETWORK-STATUS. See <a href="#new_attributes">Section 6</a> for the formal description. It is RECOMMENDED to add them to a STUN request response pair, especially if the NETWORK-STATUS attribute is in use. This allows the information gathered to be sent back to the requesting agent in the the STUN response.  </p>
<p id="rfc.section.2.p.2">The STREAM-TYPE, BANDWIDTH-USAGE, STREAM-PRIORITY attributes MUST be added before any INTEGRITY attribute. It is RECOMMENDED to only add these attributes to STUN messages containing a INTEGRITY attribute as this prevents tampering with the content of the attribute.  </p>
<p id="rfc.section.2.p.3">If the client wants to receive feedback from the network it must add a null NETWORK-STATUS attribute. A null NETWORK_STATUS attribute is created by filling in the all the fields in the attribute with 0x0 values. This attribute MUST be added after the INTEGRITY attribute, as on-path devices may write information into this attribute. Having a readily available attribute to write into will save the the on-path device from growing buffers to add their own attribute. On path devices SHOULD not add their own NETWORK-STATUS attribute (or any other STUN attribute).  </p>
<p id="rfc.section.2.p.4">If an agent receives a STUN request with a NETWORK-STATUS attribute after the INTEGRITY attribute, it should copy the content into a new NETWORK-STATUS attribute and add it before the INTEGRITY attribute when sending the STUN response. A new null NETWORK-STATUS attribute can be added after the INTEGRITY attribute. New STUN attributes described in this draft can also be added describing the stream in this direction.  </p>
<p id="rfc.section.2.p.5">If an agent receives a STUN response with a NETWORK-STATUS attribute before the INTEGRITY attribute, this describes the stream in the upstream direction. A NETWORK-STATUS attribute after the INTEGRITY attribute describes the stream in the downstream direction.  </p>
<p id="rfc.section.2.p.6">It might make sense to distinguish DISCUSS packets from normal STUN packets. This would prevent unnecessary processing of normal STUN packets on the network nodes.  </p>
<p><a id="Q2" class="info">[Q2]<span class="info">palmarti: A few alternatives (Needs discussion): ---1: Alter the STUN magic cookie. (But than i would not be a STUN packet anymore, and that raises a new set of problems) ---2: Add a special this is DISCUSS attribute. This must be the first attribute in the message. This allows for network node to look for DISCUSS packets at a fixed offset without needing to parse the entire packet.  ---3: Alter the transaction id. This might be problematic if using it in conjunction with ICE connectivity checks. But probably fine in other scenarios.  ---4: Define a new STUN Method. Also brakes ICE, makes it harder to tag onto attributes to already in use messages.  </span></a> </p>
<p><a id="Q3" class="info">[Q3]<span class="info">palmarti: Do we want to restrict this to req/resp or do we want to allow for the attributes to be added in this fashion for indications as well?</span></a> </p>
<pre>  
  Alice                router1            router2              Bob
   |                      |                   |                  |
   |Binding_Request       |                   |                  |
(1)|---------------------&gt;|(2)                |                  |
   |                      |                   |                  |
   |                      |Binding_Request    |                  |
   |                      |-------------------------------------&gt;|
   |                      |                   |                  |
   |                      |                   | Binding_Response |
   |                      |                   |&lt;-----------------|(3)
   |                      |  Binding_Response |                  |
   |&lt;-----------------------------------------|(4)               |
   |(5)                   |                   |                  |

</pre>
<p class="figure">DISCUSS example flow</p>
<p/>

<ol>
  <li>Alice creates a Binding Request, adds STREAM-TYPE, BANDWIDTH-USAGE, STREAM-PRIORITY attributes before the INTEGRITY attribute and a single null NETWORK-STATUS attribute after the INTEGRITY attribute.  </li>
  <li>Router1 inspects the STUN Request message and reads any STREAM-TYPE, BANDWIDTH-USAGE, or STREAM-PRIORITY attributes and the information they contain. It then updates the NETWORK-STATUS attribute with any information the router have. It then forwards the request.  </li>
  <li>Bob processes the STUN Request. When Bob builds the response, it copies the NETWORK-STATUS attribute into the STUN Response before the INTEGRITY check and adds new null NETWORK-STATUS attribute after the INTEGRITY attribute. Bob then transmits the message.  </li>
  <li>Router2 (first DISCUSS network element for the downstream direction) inspects the Response message, reads the STREAM-TYPE, BANDWIDTH-USAGE, or STREAM-PRIORITY attributes and MAY alter the NETWORK-STATUS attribute located after the INTEGRITY attribute. It then transmits the message.  </li>
  <li>When Alice receives the STUN Response, she can extract the STREAM-TYPE, BANDWIDTH-USAGE, or STREAM-PRIORITY attributes and the two NETWORK-STATUS attributes to get a complete picture of what the remote agent is sending and how the status of both the upstream and downstream path.  </li>
</ol>

<p> </p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> Network Processing</h1>
<p id="rfc.section.3.p.1">This section describes the processing of DISCUSS packets by network devices.  </p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> Packet Processing by Network Device</h1>
<p id="rfc.section.3.1.p.1">Network devices are said to support DISCUSS if they perform inspection of packets being forward or switched in order to identify an DISCUSS STUN packet.  These devices will also be able to read/write STUN attributes to/from this packet.  It is not required that every network device in the path support DISCUSS.  It is expected that DISCUSS will have the most value being implemented at certain points in the network (PIN's) such as WAN edge devices, wireless access devices, and Internet gateways.  </p>
<p id="rfc.section.3.1.p.2">Network devices that support DISCUSS MAY utilize the information provided by the application in the STUN attributes to modify their behavior.  These include the attributes defined in this document with the exception of the NETWORK-STATUS attribute.  The NETWORK-STATUS attribute SHOULD NOT be used by the DISCUSS capable network device to modify its behavior.  The intent of the NETWORK-STATUS attribute is for the application to modify its behavior.  </p>
<p id="rfc.section.3.1.p.3">If the NETWORK-STATUS attributes exists in a DISCUSS packet after an INTEGRITY attribute, the DISCUSS capable network device MUST process it as described in this section.  NETWORK-STATUS attributes that exist before the INTEGRITY attribute MUST NOT be modified by the network device.  The modifications to the NETWORK-STATUS attribute are: </p>

<ul>
  <li>Update the Node Cnt field in the attribute.  The device SHALL increment this field by one unless it is at its maximum (saturated) value.  If the field is at its maximum value, the device SHALL NOT modify this field.  </li>
  <li>Overwrite the attribute CS bit if the value at this device is "worst" than the current value.  In other words, only write to this bit if the device is experiencing congestion on relevant queues/interfaces for this flow AND the current value of this field is 0 (Off).  </li>
</ul>

<p> </p>
<p id="rfc.section.3.1.p.4">The determination of congestion at a device is out of the scope of this document.  Setting of CS bit to On by the device is meant to provide direct feedback to the application of potential or current loss of packets in its flow (s).  The application can then react to this indication by altering its encoding of information in the packet to deal with congestion/packet loss, e.g. reduce its encoding rate or switch to embedded encoding.  Devices SHOULD ensure that the DISCUSS capable applications that do react to congestion notification by reducing their transmission rate be treated properly to ensure fairness with non reacting applications (i.e. ensure fairness for well behaving applications).  </p>
<p id="rfc.section.3.1.p.5">The DISCUSS STUN packet SHOULD experience minimal extra processing delay through the DISCUSS capable network device relative to non-DISCUSS packets in the flow.  The DISCUSS STUN packet MAY be placed out of order in the packet flow, but SHOULD NOT be delayed more than a few packet interval times.  </p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> Interaction with DSCP</h1>
<p id="rfc.section.3.2.p.1">One of the attributes that may be added to the STUN packet by the application is the STREAM-PRIORITY attribute.  This attribute indicates the relative priority of streams inside of an application session.  This attribute is compatible with the use of DSCP (or other priority markings) at the networking layer as described in this section.  </p>
<p id="rfc.section.3.2.p.2">Since transport layer markings may be modified by middle boxes or devices in the path or at the interface of the application itself due to the lack of support in the OS network stack, the STREAM-PRIORITY attribute can be used as a mechanism for ensuring proper QoS treatment through multiple domains.  DISCUSS capable device may use the STREAM-PRIORITY attribute to remark the DSCP value to the appropriate value.  DSCP re-marking based on STREAM-PRIORITY attribute may make sense at certain PIN's, e.g. gateway between network domains (e.g. managed network to/from Internet), access switches in managed network, etc.  The translation from the Priority number in the STREAM-PRIORITY attribute to the correct transport layer marking (e.g. DSCP) is implementation specific and out of the scope of this document.  </p>
<p><a href="#I-D.dhesikan-tsvwg-rtcweb-qos">[I-D.dhesikan-tsvwg-rtcweb-qos]</a> provides the recommended DSCP values for webrtc enabled browsers to use for various classes of traffic.  </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Interaction with ICE</h1>
<p id="rfc.section.4.p.1">An ICE connectivity check is performed by sending a STUN Binding indication. Prior to sending the agent can add one STREAM-TYPE attribute. If added, only one MUST be added. This is to avoid unnecessary large STUN packets during the connectivity checks. If the connectivity check is sent on a 5-tuple that multiplexes different types of media and more detailed information wants to be signalled it should be done after the connectivity check phase is finished.  </p>
<p id="rfc.section.4.p.2">This limits the information the STUN messages are able to convey during the connectivity checks, but also avoids adding network confusion with BANDWIDTH-USAGE attributes describing different paths that never going to be utilized.  </p>
<p><a id="Q4" class="info">[Q4]<span class="info">palmarti: Problem with consent freshness if not based on STUN.  </span></a> </p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> Multiplexed Streams</h1>
<p id="rfc.section.5.p.1">In some scenarios a 5-tuple can be used to transport several media streams. BUNDLE <a href="#I-D.ietf-mmusic-sdp-bundle-negotiation">[I-D.ietf-mmusic-sdp-bundle-negotiation]</a> describes such a mechanism.  </p>
<p id="rfc.section.5.p.2">When describing the stream with a STREAM-TYPE attribute there are two possibilities to describe the streams that are multiplexed. Adding one attribute for each type (Audio, Video,++), or to save a few bits on the wire it is also possible to construct the STREAM-TYPE so a one type value describes several types. For example audio have the value of 1 and application data have the value of 4. If the STREAM_TYPE value is set to 5 the only combination that gives that is audio and application data.  </p>
<p id="rfc.section.5.p.3">The other attributes BANDWIDTH-USAGE, STREAM-PRIORITY and NETWORK-STATUS SHOULD only be added once as they describe the behaviour of the 5-tuple and not individual streams.  </p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#new_attributes" id="new_attributes">New STUN attributes</a></h1>
<p id="rfc.section.6.p.1">This STUN extension defines the following new attributes: </p>
<pre>
      0xXXX0: STREAM-TYPE
      0xXXX1: BANDWIDTH-USAGE
      0xXXX2: STREAM-PRIORITY
      0xYYYY: NETWORK-STATUS
           </pre>
<h1 id="rfc.section.6.1"><a href="#rfc.section.6.1">6.1.</a> STREAM-TYPE</h1>
<p id="rfc.section.6.1.p.1">This attribute have a length that are multiples of 4 (32) so no padding is necessary.  </p>
<div id="rfc.figure.1"/>
<div id="stream_type_attr"/>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|              TYPE             | Interactivity |               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      </pre>
<p class="figure">Figure 1: STREAM TYPE Attribute</p>
<div id="rfc.figure.2"/>
<div id="stream_types"/>
<pre>
     0x0001 Audio
     0x0002 Video
     0x0004 Application Data
     0x0008 Other
                 </pre>
<p class="figure">Figure 2: STREAM Types</p>
<div id="rfc.figure.3"/>
<div id="interactivity_types"/>
<pre>
     0x00 Undef
     0x01 Stream (Broadcast? Oneway?)
     0x02 Interactive
                     </pre>
<p class="figure">Figure 3: Interactivity Types</p>
<p/>

<dl>
  <dt>TYPE:</dt>
  <dd style="margin-left: 8">STREAM TYPE is a 16 bit value defined in <a href="#stream_types">Figure 2</a> below describing the flow.  </dd>
  <dt>Interactivity:</dt>
  <dd style="margin-left: 8">Is a 8 bit value defined in <a href="#interactivity_types">Figure 3</a> below describing the flow.  </dd>
</dl>

<p> </p>
<p id="rfc.section.6.1.p.3">It is possible to combine the stream types if a stream contains more than one type.  </p>
<p id="rfc.section.6.1.p.4">If a 5-tuple is used to send both a audio and video stream, the stream type can be set to 0x0006.  This can be useful if the application wants to hint that the 5-tuple contains several streams, This is useful if the attribute is added to STUN binding requests during ICE connectivity checks. If more information regarding multiplexed streams is needed it is possible to add more than one attribute to a STUN message (See section ??). This can be done to STUN messages that are being sent after the connectivity check phase is finished (Keep-alive, consent freshness). During this phase the added size of the STUN messages pose no security threat.  </p>
<h1 id="rfc.section.6.2"><a href="#rfc.section.6.2">6.2.</a> BANDWIDTH-USAGE</h1>
<p id="rfc.section.6.2.p.1">This attribute have a length that are multiples of 4 (32) so no padding is necessary.  </p>
<div id="rfc.figure.4"/>
<div id="bandwidth_usage_attr"/>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             AVERAGE (kbps)    |           MAX (kbps)          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      </pre>
<p class="figure">Figure 4: BANDWIDTH USAGE Attribute</p>
<p/>

<dl>
  <dt>AVERAGE:</dt>
  <dd style="margin-left: 8">Expected sustained bandwidth usage for this stream. Note that for elastic types of streams like video, sudden large movements in the picture my lead to this value being inaccurate.  </dd>
  <dt>MAX:</dt>
  <dd style="margin-left: 8">The maximum bandwidth usage for this stream. If the sustained and max value differ greatly it might be safe to assume that an elastic encoder is in use. (Would it be useful to say something about expected BURST lengths?) </dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.3"><a href="#rfc.section.6.3">6.3.</a> STREAM-PRIORITY</h1>
<p id="rfc.section.6.3.p.1">This attribute have a length that are multiples of 4 (32) so no padding is necessary.  </p>
<div id="rfc.figure.5"/>
<div id="stream_priority_attr"/>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Priority      |D|    TBD      |           Stream IDX          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Session ID                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      </pre>
<p class="figure">Figure 5: STREAM PRIORITY Attribute</p>
<p/>

<dl>
  <dt>Priority:</dt>
  <dd style="margin-left: 8">Describes this streams priority among other streams coming from this endpoint/application (With same session ID). Values range from 255 (0xFF) to 0.  </dd>
  <dt>D:</dt>
  <dd style="margin-left: 8">Delay sensitive. The application can set this bit as a hint to the network element that the stream is delay sensitive. (Unsure if this is useful) </dd>
  <dt>Stream IDX:</dt>
  <dd style="margin-left: 8">Application can choose set this to ease debugging in the network. A reasonable value can foe example be the index have in the SDP.  </dd>
  <dt>Session ID:</dt>
  <dd style="margin-left: 8">Identification to distinguish what session this stream is part of. This MUST have the same value for all the media streams the application wants to give differentiated services. (Note that this ID may overlap with other streams that originates from a different IP address. The network element MUST only prioritize among streams with the same Session Id originating from the same IP) </dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.4"><a href="#rfc.section.6.4">6.4.</a> NETWORK-STATUS</h1>
<p id="rfc.section.6.4.p.1">This attribute have a length that are multiples of 4 (32) so no padding is necessary. The values are kept in the same attribute to make it easier for the network element to process it. Only one attribute, with static placement of the fields.  <a id="Q5" class="info">[Q5]<span class="info">palmarti: Does this matter? Could we have several attributes with possible different ordering without any problem for the network element? </span></a> </p>
<p id="rfc.section.6.4.p.2">This attribute MUST be added after any INTEGRITY attribute in the STUN message. Values in this attribute can be updated along the network path by nodes that are not able to regenerate a correct INTEGRITY attribute.  </p>
<div id="rfc.figure.6"/>
<div id="network_status_attr"/>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|C|    Flags    | Node Cnt      |             TBD               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Up MAX Bitrate  (kbps)      | Down MAX Bitrate  (kbps)      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

 
      </pre>
<p class="figure">Figure 6: NETWORK-STATUS Attribute</p>
<p/>

<dl>
  <dt>C:</dt>
  <dd style="margin-left: 8">Congestion Status.  This bit is set to indicate that there is congestion at the network device's relevant queues/interfaces for this flow.  The network element should set this bit to 1 (On) if it is experiencing congestion.  This bit is set to 0 (off) when the attribute is created by the application.  The application that sees this bit set might act on it by doing some rate adaption or similar action.  </dd>
  <dt>Flags:</dt>
  <dd style="margin-left: 8">7 more bits available for flags.  </dd>
  <dt>Node Cnt:</dt>
  <dd style="margin-left: 8">Numbers of nodes that supports DISCUSS in the network path. Any router on the path that understands DISCUSS should increase this number.  This field is set to 0 when the attribute is created by the application.  </dd>
  <dt>TBD:</dt>
  <dd style="margin-left: 8">16 more bits available for useful info.  </dd>
  <dt>Up MAX Bitrate:</dt>
  <dd style="margin-left: 8">Available MAX bit-rate the router is able to handle for the 5-tuple in the UP direction. (Same direction as the packet is moving) </dd>
  <dt>Down MAX Bitrate:</dt>
  <dd style="margin-left: 8">Available MAX bit-rate the router is able to handle for the 5-tuple in the DOWN direction. (Opposite direction as the packet is moving) </dd>
</dl>

<p> </p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#ack" id="ack">Acknowledgements</a></h1>
<p id="rfc.section.7.p.1">Authors would like to thank Dan Wing, Anca Zamfir and Cullen Jennings for their comments and review.  </p>
<h1 id="rfc.references"><a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2474">[RFC2474]</b>
      </td>
      <td class="top"><a href="mailto:kmn@cisco.com" title="Cisco Systems">Nichols, K.</a>, <a href="mailto:slblake@torrentnet.com" title="Torrent Networking Technologies">Blake, S.</a>, <a href="mailto:fred@cisco.com" title="Cisco Systems">Baker, F.</a> and <a href="mailto:black_david@emc.com" title="EMC Corporation">D. Black</a>, "<a href="http://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>", RFC 2474, December 1998.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5389">[RFC5389]</b>
      </td>
      <td class="top"><a>Rosenberg, J.</a>, <a>Mahy, R.</a>, <a>Matthews, P.</a> and <a>D. Wing</a>, "<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>", RFC 5389, October 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5245">[RFC5245]</b>
      </td>
      <td class="top"><a>Rosenberg, J.</a>, "<a href="http://tools.ietf.org/html/rfc5245">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>", RFC 5245, April 2010.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">8.2.</a> Informational References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-rtcweb-security-arch">[I-D.ietf-rtcweb-security-arch]</b>
      </td>
      <td class="top"><a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-rtcweb-security-arch-09">WebRTC Security Architecture</a>", Internet-Draft draft-ietf-rtcweb-security-arch-09, February 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.thomson-mmusic-ice-webrtc">[I-D.thomson-mmusic-ice-webrtc]</b>
      </td>
      <td class="top"><a>Thomson, M.</a>, "<a href="http://tools.ietf.org/html/draft-thomson-mmusic-ice-webrtc-01">Using Interactive Connectivity Establishment (ICE) in Web Real-Time Communications (WebRTC)</a>", Internet-Draft draft-thomson-mmusic-ice-webrtc-01, October 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.dhesikan-tsvwg-rtcweb-qos">[I-D.dhesikan-tsvwg-rtcweb-qos]</b>
      </td>
      <td class="top"><a>Dhesikan, S.</a>, <a>Druta, D.</a>, <a>Jones, P.</a> and <a>J. Polk</a>, "<a href="http://tools.ietf.org/html/draft-dhesikan-tsvwg-rtcweb-qos-06">DSCP and other packet markings for RTCWeb QoS</a>", Internet-Draft draft-dhesikan-tsvwg-rtcweb-qos-06, March 2014.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-mmusic-sdp-bundle-negotiation">[I-D.ietf-mmusic-sdp-bundle-negotiation]</b>
      </td>
      <td class="top"><a>Holmberg, C.</a>, <a>Alvestrand, H.</a> and <a>C. Jennings</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mmusic-sdp-bundle-negotiation-05">Multiplexing Negotiation Using Session Description Protocol (SDP) Port Numbers</a>", Internet-Draft draft-ietf-mmusic-sdp-bundle-negotiation-05, October 2013.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Paal-Erik Martinsen</span> 
	  <span class="n hidden">
		<span class="family-name">Martinsen</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span class="vcardline">Philip Pedersens vei 20</span>

	  <span class="vcardline">
		<span class="locality">Lysaker</span>,  
		<span class="region">Akershus</span> 
		<span class="code">1366</span>
	  </span>
	  <span class="country-name vcardline">Norway</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:palmarti@cisco.com">palmarti@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Herb Wildfeuer</span> 
	  <span class="n hidden">
		<span class="family-name">Wildfeuer</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span class="vcardline">821 Alder Drive</span>

	  <span class="vcardline">
		<span class="locality">Milpitas</span>,  
		<span class="region">California</span> 
		<span class="code">95035</span>
	  </span>
	  <span class="country-name vcardline">United States</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hwildfeu@cisco.com">hwildfeu@cisco.com</a></span>

  </address>
</div>

</body>
</html>
