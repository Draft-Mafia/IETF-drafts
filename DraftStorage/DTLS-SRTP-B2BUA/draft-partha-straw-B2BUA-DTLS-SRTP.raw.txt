



STRAW                                           Parthasarathi. Ravindran
Internet-Draft                              Nokia Solutions and Networks
Intended status: Standards Track                         R. Ravindranath
Expires: November 8, 2014                                       T. Reddy
                                                           Cisco Systems
                                                             May 7, 2014


  DTLS-SRTP handling in Session Initiation Protocol (SIP) Back-to-Back
                          User Agents (B2BUAs)

Abstract

   SIP Back-to-Back User Agents (B2BUAs) are often envisaged to also be
   on the media path, rather than just intercepting signaling.  This
   document describes the behavior B2BUAs should follow when acting on
   the media plane that use Secure Real-time Transport Protocol (SRTP)
   security context setup with Datagram Transport Layer Security (DTLS)
   protocol.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on November 8, 2014.

Copyright Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction
   2.  Terminology
   3.  Media plane B2BUAs
     3.1.  Media relay
     3.2.  Media-aware relay or Media terminator
   4.  DTLS-SRTP handling in B2BUA with signaling forking
   5.  Security Considerations
   6.  IANA Considerations
   7.  Acknowledgement
   8.  Normative References
   Authors' Addresses

1.  Introduction

   [RFC5763] describes how Session Initiation Protocol (SIP) can be used
   to establish a Secure Real-time Transport Protocol (SRTP) security
   context with Datagram Transport Layer Security (DTLS) protocol.  It
   describes a mechanism of transporting a certificate fingerprint in
   Session Description Protocol (SDP), which identifies the certificate
   that will be presented during the DTLS handshake.  DTLS-SRTP is
   defined for point-to-point media sessions, in which there are exactly
   two participants.  Each DTLS-SRTP session contains a single DTLS
   association, and either two SRTP contexts (if media traffic is
   flowing in both directions on the same host/port quartet) or one SRTP
   context (if media traffic is only flowing in one direction).

   In may SIP deployments, SIP entities exist in the SIP signaling path
   between the originating and final terminating endpoints.  These SIP
   entities as described in [RFC7092] modify SIP and SDP bodies and also
   are likely to be on the media path.  Such Entities when present in
   the signaling/media path are likely to do several things.  For
   example some B2BUAs modify parts of SDP (like IP address, port) and
   subsequently modify the RTP headers as well.  There are other types
   of B2BUAs that would completely modify the RTP packet including the
   payload(like transcoder).  In all these cases a DTLS association
   would break unless the B2BUA participates in the DTLS setup and
   ensures the context are setup properly.  It is envisioned that B2BUA
   that are in media path MUST support DTLS stack and SRTP extensions
   needed for DTLS as described in [RFC5763] so that it can function as
   DTLS-SRTP proxy.

   [RFC7092] describes three different categories of such B2BUAs,
   according to the level of activities performed on the media plane:

      A B2BUA that act as a simple media relay effectively unaware of
      anything that is transported and only modifies the UDP/IP header
      of the packets.

      A B2BUA that performs a media-aware role.  It inspects and
      potentially modifies RTP or RTCP headers, but it does not modify
      the payload of RTP/RTCP.

      A B2BUA that performs a media-termination role and operates at the
      media payload layer, such as RTP/RTCP payload (For example
      Transcoder).

   The following sections will describe the behaviour B2BUAs should
   follow in order to avoid any impact on end-to-end DTLS-SRTP streams.

2.  Terminology

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].  Readers of
   this document are expected to be aware of different B2BUA's defined
   in [RFC7092].

3.  Media plane B2BUAs

3.1.  Media relay

   A media relay as identified in section 3.2.1 of [RFC7092] basically
   just forwards, from an application level point of view, all packets
   it receives on a negotiated UDP connection, without either inspecting
   or modifying them.  They just forward the UDP payload as is by
   changing only the UDP/IP header.

   A media relay B2BUA MUST forward the certificate fingerprint it
   receives in SDP from the originating endpoint as is to the remote
   side and vice-versa.  Below example shows a sample flow of Early
   Offer SIP SIP call with both endpoints doing DTLS-SRTP with a media
   relay B2BUA that changes the UDP/IP address/port.

 +-------+              +-----------------+        +-----------+
 |  Alice|              | MediaRelay B2BUA|        |      Bob  |
 +-------+              +-----------------+        +-----------+
     |(1) INVITE               |  (3)INVITE                |
     |   a=setup:actpass       |   a=setup:actpass         |
     |   a=fingerprint1        |   a= fingerprint1         |
     |   (alice's IP/port)     |   (B2BUA's IP, port)      |
     |------------------------>|  ------------------------>|
     |                         |                           |
     |    (2)  100 trying      |                           |
     | <-----------------------|                           |
     |                         | (4) 100 trying            |
     |                         | <-------------------------|
     |                         |                           |
     |                         |  (5)200 OK                |
     |                         |   a=setup:active          |
     |                         |    a=fingerprint2         |
     |                         |  (Bob's IP, port)         |
     |                         | <-------------------------|
     |    (6) 200 OK           |                           |
     |    a=setup:active       |                           |
     |    a=fingerprint2       |                           |
     |    B2BUA's address,port |                           |
     |               (7, 8)ClientHello + use_srtp          |
     |<------------------------|<--------------------------|
     |                         |                           |
     |                         |                           |
     |           (9,10)ServerHello + use_srtp              |
     |------------------------>|-------------------------->|
     |                 (11)    |                           |
     |  [Certificate exchange between Alice and Bob over   |
     |   DTLS ]                |                           |
     |                         |                           |
     |         (12)            |                           |
     |<---------SRTP/SRTCP---->|<----SRTP/SRTCP----------->|
     |   [B2BUA just changes UDP/IP header]                |



     For the sake of brevity the entire fingerprint attribute is not shown.

                  Figure 1: Early Offer Media Relay B2BUA

   For each RTP or RTCP flow the peers do a DTLS handshake on the same
   source and destination port pair to establish a DTLS association.  In
   this case Bob After he receives an INVITE triggers a DTLS connection.
   Note the DTLS handshake as well as the response to INVITE may happen
   in parallel and so the B2BUA SHOULD be prepared to receive media on
   the ports it advertised to Bob in the OFFER.  Since a media relay
   B2BUA does not differentiate between a DTLS or RTP or any packet sent
   it just changes the UDP/IP addresses and forwards the packet on
   either leg.

3.2.  Media-aware relay or Media terminator

   A Media-aware relay, unlike the the Media Relay addressed in the
   previous section, is actually aware of the media traffic it is
   handling.  As such, it is able to inspect SRTP and SRTCP packets
   flowing by, and may even be able to modify the headers in any of them
   before forwarding them.  A B2BUA implementing this role would not,
   though, inspect the payloads as well, which would be opaque to them.

   A media terminator B2BUA in addition to modifying the header can
   modify parts of the payload.  For example a Transcoder is a type of
   Media terminator that modifies the payload before it forwards the
   packet.  It is envisioned that these B2BUA's SHOULD have the
   capability the distinguish DTLS or SRTP or SRTCP or other packets
   (like STUN) received on the same udp port by using the algorithm
   mentioned in section 5.1.2 of [RFC5764] and takes care of handling
   them separately.

   Below example shows how a DTLS-SRTP session is setup for these B2BUA

 +-------+              +-----------------+        +-----------+
 |  Alice|              | MediaAware B2BUA|        |      Bob  |
 +-------+              +-----------------+        +-----------+
     |(1) INVITE               |  (3)INVITE                |
     |   a=setup:actpass       |   a=setup:actpass         |
     |   a=fingerprint1        |   a= fingerprint2         |
     |   (alice's IP/port)     |   (B2BUA's IP, port)      |
     |------------------------>|  ------------------------>|
     |                         |                           |
     |    (2)  100 trying      |                           |
     | <-----------------------|                           |
     |                         | (4) 100 trying            |
     |                         | <-------------------------|
     |                         |                           |
     |                         |  (5)200 OK                |
     |                         |   a=setup:active          |
     |                         |    a=fingerprint3         |
     |                         |  (Bob's IP, port)         |
     |                         | <-------------------------|
     |                         |(6)ClientHello + use_srtp  |
     |                         |<--------------------------|
     |    (7) 200 OK           |                           |
     |    a=setup:active       | ServerHello + use_srtp (8)|
     |    a=fingerprint4       | ------------------------->|
     |    B2BUA's address,port |             (9,10)        |
     | <-----------------------|   [Cert Exchange between] |
     |  (11)ClientHello+       |      Bob and B2BUA over   |
     |     use_srtp            |              DTLS         |
     |<------------------------|                           |
     |  (12)ServerHello+       |                           |
     |   use_srtp              |                           |
     |------------------------>|                           |
     |                 (13,14  |                           |
     |  [Cert exchange between |                           |
     |   Alice and B2BUA       |                           |
     |   DTLS ]                |                           |
     |                         |                           |
     |         (15)            |          (16)             |
     |<---------SRTP/SRTCP---->|<----SRTP/SRTCP----------->|
     |   [B2BUA modifes SRTP/SRTCP header and/or payload]  |



     For the sake of brevity the entire fingerprint attribute is not shown.
     Also the same flow would be applicable for Delayed Offer calls.

                  Figure 2: Early Offer Media aware B2BUA

   NOTE: Steps 5,6 may be parallel and so the B2BUA MAY receive
   ClientHello before it sees a 200OK.  Steps 7,8 can happen in any
   order.  Also steps 9,10, 11 may be parallel.  B2BUA should be
   prepared to handle these responses on each leg independently.

   A media terminator B2BUA MUST change the certificate fingerprint from
   both the endpoints so that it can signal its own certificate
   fingerprint in the SDP.  This way B2BUA can act as DTLS-SRTP proxy
   and modify the payload.

4.  DTLS-SRTP handling in B2BUA with signaling forking

   B2BUA's may receive multiple answers for an outbound INVITE due to
   downstream proxy forking the INVITE to multiple targets.  It is
   possible that each of these responses have different certificate
   fingerprints.  The B2BUA SHOULD take care of setting separate DTLS-
   SRTP associations with each of the forked targets.

5.  Security Considerations

   Security considerations in [RFC5763] should be taken into account.

6.  IANA Considerations

   This document makes no request of IANA.

7.  Acknowledgement

8.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC5764]  McGrew, D. and E. Rescorla, "Datagram Transport Layer
              Security (DTLS) Extension to Establish Keys for the Secure
              Real-time Transport Protocol (SRTP)", RFC 5764, May 2010.

   [RFC5763]  Fischl, J., Tschofenig, H., and E. Rescorla, "Framework
              for Establishing a Secure Real-time Transport Protocol
              (SRTP) Security Context Using Datagram Transport Layer
              Security (DTLS)", RFC 5763, May 2010.

   [RFC7092]  Kaplan, H. and V. Pascual, "A Taxonomy of Session
              Initiation Protocol (SIP) Back-to-Back User Agents", RFC
              7092, December 2013.

Authors' Addresses

   Parthasarathi Ravindran
   Nokia Solutions and Networks
   Manyata Embassy Business park
   Bangalore, Karnataka  560045
   India

   Email: partha@parthasarathi.co.in


   Ram Mohan Ravindranath
   Cisco Systems
   Cessna Business Park
   Sarjapur-Marathahalli Outer Ring Road
   Bangalore, Karnataka  560103
   India

   Email: rmohanr@cisco.com


   Tirumaleswar Reddy
   Cisco Systems
   Cessna Business Park, Varthur Hobli
   Sarjapur Marathalli Outer Ring Road
   Bangalore, Karnataka  560103
   India

   Email: tireddy@cisco.com

