<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>TURN Extension for Third Party Authorization</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Solution Overview"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Obtaining a Token Using OAuth"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Forming a Request"/>
<link href="#rfc.section.6" rel="Chapter" title="6 TURN Server validating Request"/>
<link href="#rfc.section.7" rel="Chapter" title="7 STUN Attributes"/>
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 THIRD-PARTY-AUTHORIZATION"/>
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 ACCESS-TOKEN"/>
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 TIMESTAMP"/>
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 KEY-ID"/>
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 MAC-ALGORITHM"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations"/>
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations"/>
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="11 References"/>
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.2 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Reddy, T., Patil, P., Ravindranath, R., and J. Uberti" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-reddy-tram-turn-third-party-authz-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2014-1-22" />
  <meta name="dct.abstract" content="This document proposes the use of OAuth to obtain and validate ephemeral tokens that can be used for TURN authentication. The usage of ephemeral tokens ensure that access to a TURN server can be controlled even if the tokens are compromised, as is the case in WebRTC where TURN credentials must be specified in Javascript. It also addresses the need for stronger authentication described in " />
  <meta name="description" content="This document proposes the use of OAuth to obtain and validate ephemeral tokens that can be used for TURN authentication. The usage of ephemeral tokens ensure that access to a TURN server can be controlled even if the tokens are compromised, as is the case in WebRTC where TURN credentials must be specified in Javascript. It also addresses the need for stronger authentication described in " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">TRAM</td>
  <td class="right">T. Reddy</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">P. Patil</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">R. Ravindranath</td>
</tr>
<tr>
  <td class="left">Expires: July 26, 2014</td>
  <td class="right">Cisco</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">J. Uberti</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Google</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">January 22, 2014</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">TURN Extension for Third Party Authorization<br />
  <span class="filename">draft-reddy-tram-turn-third-party-authz-00</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document proposes the use of OAuth to obtain and validate ephemeral tokens that can be used for TURN authentication. The usage of ephemeral tokens ensure that access to a TURN server can be controlled even if the tokens are compromised, as is the case in WebRTC where TURN credentials must be specified in Javascript. It also addresses the need for stronger authentication described in <a href="#I-D.reddy-behave-turn-auth">[I-D.reddy-behave-turn-auth]</a>.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on July 26, 2014.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2014 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Terminology</a></li>
<li>3.   <a href="#rfc.section.3">Solution Overview</a></li>
<li>4.   <a href="#rfc.section.4">Obtaining a Token Using OAuth</a></li>
<li>5.   <a href="#rfc.section.5">Forming a Request</a></li>
<li>6.   <a href="#rfc.section.6">TURN Server validating Request</a></li>
<li>7.   <a href="#rfc.section.7">STUN Attributes</a></li>
<li>7.1.   <a href="#rfc.section.7.1">THIRD-PARTY-AUTHORIZATION</a></li>
<li>7.2.   <a href="#rfc.section.7.2">ACCESS-TOKEN</a></li>
<li>7.3.   <a href="#rfc.section.7.3">TIMESTAMP</a></li>
<li>7.4.   <a href="#rfc.section.7.4">KEY-ID</a></li>
<li>7.5.   <a href="#rfc.section.7.5">MAC-ALGORITHM</a></li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a></li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a></li>
<li>10.   <a href="#rfc.section.10">Acknowledgements</a></li>
<li>11.   <a href="#rfc.references">References</a></li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a></h1>
<p id="rfc.section.1.p.1">TURN <a href="#RFC5766">[RFC5766]</a> is a protocol that is often used to improve the connectivity of P2P applications. By providing a cloud-based relay service, TURN ensures that a connection can be established even when one or both sides is incapable of a direct P2P connection. However, as a relay service, it imposes a nontrivial cost on the service provider. Therefore, access to a TURN service is almost always access-controlled.</p>
<p id="rfc.section.1.p.2">TURN provides a mechanism to control access via "long-term" username/ password credentials that are provided as part of the TURN protocol. It is expected that these credentials will be kept secret; if the credentials are discovered, the TURN server could be used by unauthorized users or applications. However, in web applications, ensuring this secrecy is typically impossible. To address this problem and the ones described in <a href="#I-D.reddy-behave-turn-auth">[I-D.reddy-behave-turn-auth]</a>, this document proposes the use of third party authorization using OAuth for TURN.</p>
<p id="rfc.section.1.p.3">To achieve third party authorization, a resource owner eg WebRTC setver, authorizes a TURN client to access resources on the TURN server.  </p>
<p id="rfc.section.1.p.4">Using OAuth, a client obtains an ephemeral token from an authorization server eg WebRTC server, and the token is presented to the TURN server instead of the traditional mechanism of presenting username/password credentials. The TURN server validates the authenticity of the token and provides required services.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#term" id="term">Terminology</a></h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p/>

<ul>
  <li>WebRTC Server: A web server that supports WebRTC <a href="#I-D.ietf-rtcweb-overview">[I-D.ietf-rtcweb-overview]</a>.</li>
  <li>Access Token: OAuth 2.0 access token.</li>
  <li>mac_key: The session key generated by the authorization server.  Note that the lifetime of the session key is equal to the lifetime of the access token.</li>
  <li>kid: The name of the key (key id), which is an identifier generated by the resource server.</li>
</ul>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#problem_stmt" id="problem_stmt">Solution Overview</a></h1>
<p id="rfc.section.3.p.1">This specification uses the token type 'Assertion' (aka self-contained token) described in <a href="#RFC6819">[RFC6819]</a> where all the information necessary to authenticate the validity of the token is contained within the token itself. This approach has the benefit of avoiding a protocol between the TURN server and the authorization server for token validation, thus reducing latency. The exact mechanism used by a client to obtain a token from the OAuth authorization server is outside the scope of this document. For example, a client could make an HTTP request to an authorization server to obtain a token that can be used to avail TURN services. The TURN token is returned as JSON, along with other OAuth Parameters like token type, mac_key, mac_algorithm, kid, token lifetime etc. The client is oblivious to the content of the token. The token is securely embedded within a TURN request sent to the TURN server. Once the TURN server has determined the token is valid, TURN services are offered for a determined period of time.</p>
<div id="rfc.figure.1"/>
<div id="figure1"/>
<pre>

+-------------------+                         +--------+  +---------+  
| .........  TURN   |                         |  TURN  |  |  WebRTC |
| .WebRTC .  Client |                         |        |  |         | 
| .Client .         |                         | Server |  |  Server |
| .........         |                         |        |  |         | 
+-------------------+                         +--------+  +---------+
  |       |               Allocate request            |         |
  |       |------------------------------------------&gt;|         |
  |       |                                           |         |
  |       |         Allocate error response           |         |
  |       |&lt;------------------------------------------|         |
  |       |         THIRD-PARTY-AUTHORIZATION         |         |                                        
  |       |                                           |         |
  |       |      HTTP Request for token               |         |
  |------------------------------------------------------------&gt;|
  |       |      HTTP Response with token parameters  |         |
  |&lt;------------------------------------------------------------|
  |       |                                           |         | 
  |OAuth  |                                           |         |
   Attributes                                         |         |
  |-----&gt; |                                           |         |
  |       |               Allocate request            |         |
  |       |------------------------------------------&gt;|         |
  |       |ACCESS-TOKEN, TIMESTAMP, KEY-ID, MAC-ALGORITHM       |
  |       |                                           |         |
  |       |                                           |         |
  |       |         Allocate success response         |         |
  |       |&lt;------------------------------------------|         |
  |       |             TURN Messages                 |         |
  |       |      ////// integrity protected //////    |         |
  |       |      ////// integrity protected //////    |         |
  |       |      ////// integrity protected //////    |         |
       </pre>
<p class="figure">Figure 1: TURN Third Party Authorization</p>
<p/>
<p id="rfc.section.3.p.3">For example HTTP response from Authorization server:</p>
<div id="rfc.figure.2"/>
<div id="Example"/>
<p/>
<pre>
     HTTP/1.1 200 OK
     Content-Type: application/json
     Cache-Control: no-store

     {
       "access_token":
   "eyJhbGciOiJSU0ExXzUiLCJlbmMiOiJBMTI4Q0JDK0hTMjU2In0.
   pwaFh7yJPivLjjPkzC-GeAyHuy7AinGcS51AZ7TXnwkC80Ow1aW47kcT_UV54ubo
   nONbeArwOVuR7shveXnwPmucwrk_3OCcHrCbE1HR-Jfme2mF_WR3zUMcwqmU0RlH
   kwx9txo_sKRasjlXc8RYP-evLCmT1XRXKjtY5l44Gnh0A84hGvVfMxMfCWXh38hi",
       "token_type":"mac",
       "expires_in":1800,
       "refresh_token":"8xLOxBtZp8",
       "kid":"22BIjxU93h/IgwEb4zCRu5WF37s=",
       "mac_key":"adijq39jdlaska9asud",
       "mac_algorithm":"hmac-sha1-160"
     }
              </pre>
<p class="figure">Figure 2: Example</p>
<p/>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#oauth" id="oauth">Obtaining a Token Using OAuth</a></h1>
<p id="rfc.section.4.p.1">A TURN client should know the authentication capability of the TURN server before deciding to use third party authorization with it. A TURN client initially makes a request without any authorization. If the TURN server supports or mandates third party authorization, it will return an error message indicating support for third party authorization. The TURN server includes an ERROR-CODE attribute with a value of 401 (Unauthorized), a nonce value in a NONCE attribute and a SOFTWARE attribute that gives information about the TURN server's software. The TURN servers also includes additional STUN attribute THIRD-PARTY-AUTHORIZATION signalling the TURN client that the TURN server supports third party authorization.</p>
<div id="rfc.figure.3"/>
<div id="oauth_webrtc_terminology_map"/>
<p>The following mapping of OAuth concepts to WebRTC is used :</p>
<pre>
              +----------------------+----------------------------+
              |         OAuth        |            WebRTC          |
              +======================+============================+
              | Client               | WebRTC client              |
              +----------------------+----------------------------+
              | Resource owner       | WebRTC server              |
              +----------------------+----------------------------+
              | Authorization server | Authorization server       |
              +----------------------+----------------------------+
              | Resource server      | TURN Server                |
              +----------------------+----------------------------+
              </pre>
<p class="figure">Figure 3: OAuth terminology mapped to WebRTC terminology</p>
<p/>
<p id="rfc.section.4.p.3">Using the OAuth 2.0 authorization framework, a WebRTC client (third-party application) obtains limited access to a TURN (resource server) on behalf of the WebRTC server (resource owner or authorization server). The WebRTC client requests access to resources controlled by the resource owner (WebRTC server) and hosted by the resource server (TURN server). The WebRTC client obtains access token, lifetime, session key (in the mac_key parameter), key-id and mac_algorithm OAuth parameters from the authorization server as specified in <a href="#I-D.ietf-oauth-v2-http-mac">[I-D.ietf-oauth-v2-http-mac]</a>. The TURN client conveys the access token and other OAuth parameters learnt from the authorization server to the resource server (TURN server). The TURN obtains the session key via the access token. Both of these two key distribution steps are described in more detail in Section 4 of <a href="#I-D.ietf-oauth-v2-http-mac">[I-D.ietf-oauth-v2-http-mac]</a>. The TURN server validates the token, computes the message integrity of the request and takes appropriate action i.e permits the TURN client to create allocations.  This is shown in an abstract way in <a href="#interactions">Figure 4</a>.</p>
<div id="rfc.figure.4"/>
<div id="interactions"/>
<pre>                        
                        +---------------+
                        |               +&lt;******+
         +-------------&gt;| Authorization |       *
         |              | Server        |       *    
         |   +----------|(WebRTC Server)|       *  AS-RS Key 
         |   |          |               |       *     (4) 
(1)      |   |           +---------------+      *   
Access   |   |  (2)                             *
Token    |   | Access Token                     *
Request  |   |    +                             *
         |   | Session Key                      *
         |   |                                  *
         |   V                                  V
     +-------+---+                       +-+----=-----+
     |           |         (3)           |            |
     |           | TURN Request + Access |            |
     | WebRTC    | Token                 | TURN       |
     | Client    |----------------------&gt;| Server     |
     | (Alice)   |                       |            |
     |           |                       |            |
     +-----------+                       +------------+

User : Alice
****: Out-of-Band Long-Term Key Establishment

</pre>
<p class="figure">Figure 4: Interactions</p>
<p/>
<p id="rfc.section.4.p.5">OAuth in <a href="#RFC6749">[RFC6749]</a> defines four grant types. This specification uses the OAuth grant type "Implicit" explained in section 1.3.2 of <a href="#RFC6749">[RFC6749]</a> where the WebRTC client is issued an access token directly. The scope of the access token explained in section 3.3 of <a href="#RFC6749">[RFC6749]</a> MUST be TURN.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#Request" id="Request">Forming a Request</a></h1>
<p id="rfc.section.5.p.1">When a TURN server responds that third party authorization is required, a TURN client re-attempts the request, this time including access token, timestamp, lifetime, kid and mac_algorithm values in ACCESS-TOKEN, TIMESTAMP, LIFETIME, KEY-ID and MAC-ALGORITHM STUN attributes. The TURN client includes a MESSAGE-INTEGRITY attribute as the last attribute in the message over the contents of the TURN message using the mac_key and mac_algorithm. MESSAGE-INTEGRITY attribute is calculated using the other rules specified in section 15.4 of <a href="#RFC5389">[RFC5389]</a>.</p>
<p id="rfc.section.5.p.2">The TURN client MUST not include the USERNAME attribute in the request. This differs from the long-term credential mechanism described in <a href="#RFC5389">[RFC5389]</a>.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#Response" id="Response">TURN Server validating Request</a></h1>
<p id="rfc.section.6.p.1">The TURN server, on receiving a request, performs checks listed in section 10.2.2 of <a href="#RFC5389">[RFC5389]</a> in addition to the following steps to verify that the access token is valid:</p>
<p/>

<ul>
  <li>The mac_key is transported to the TURN server using the mechanism explained in section 4.2 of <a href="#I-D.ietf-oauth-v2-http-mac">[I-D.ietf-oauth-v2-http-mac]</a>.</li>
  <li>The TURN server uses the mac_key and mac_algorithm to compute the value for the message integrity and if the resulting value does not match the contents of the MESSAGE-INTEGRITY attribute then reject the request with an error response 401 (Unauthorized).</li>
  <li>The TURN server verifies that no replay took place by comparing the value in the TIMESTAMP attribute with the local time. The timestamp verification procedure is described in Section 6.1 of <a href="#I-D.ietf-oauth-v2-http-mac">[I-D.ietf-oauth-v2-http-mac]</a>.</li>
  <li>If all the checks pass, the TURN server continues to process the request. Any response generated by the server MUST include the MESSAGE-INTEGRITY attribute, computed using the mac_key and mac_algorithm.</li>
  <li>The TURN server does not check for the presence of USERNAME.</li>
</ul>
<p id="rfc.section.6.p.3">A TURN response is discarded by the client if the value computed for message integrity using mac_key and mac_algorithm does not match the contents of the MESSAGE-INTEGRITY attribute.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> STUN Attributes</h1>
<p id="rfc.section.7.p.1">The following new STUN attributes are introduced by this specification to accomplish third party authorization.</p>
<h1 id="rfc.section.7.1"><a href="#rfc.section.7.1">7.1.</a> <a href="#attribute" id="attribute">THIRD-PARTY-AUTHORIZATION</a></h1>
<p id="rfc.section.7.1.p.1">This attribute is used by the TURN server to inform the client that it supports third party authorization. This attribute has no value part and thus the attribute length field is 0.</p>
<h1 id="rfc.section.7.2"><a href="#rfc.section.7.2">7.2.</a> <a href="#token" id="token">ACCESS-TOKEN</a></h1>
<p id="rfc.section.7.2.p.1">The access token is issued by the authorization server. OAuth does not impose any limitation on the length of the access token but since STUN messages cannot exceed 548 bytes (Section 7.1 of <a href="#RFC5389">[RFC5389]</a>), access token length needs to be restricted to fit within the maximum STUN message size. The value of ACCESS-TOKEN is a variable-length value. Its length MUST be less than 513 bytes.</p>
<p id="rfc.section.7.2.p.2">Since the access token is valid for a period of time the resource server MUST cache it so that it does not need to be provided in every request from the client. The ACCESS-TOKEN MUST only be included in the first request from the client to the server but MUST NOT be included in a subsequent request/response.</p>
<h1 id="rfc.section.7.3"><a href="#rfc.section.7.3">7.3.</a> <a href="#timestamp" id="timestamp">TIMESTAMP</a></h1>
<p id="rfc.section.7.3.p.1">64-bit unsigned integer field containing a timestamp. The value indicates the time since January 1, 1970, 00:00 UTC, by using a fixed point format. In this format, the integer number of seconds is contained in the first 48 bits of the field, and the remaining 16 bits indicate the number of 1/64K fractions of a second (Native format - Unix).</p>
<h1 id="rfc.section.7.4"><a href="#rfc.section.7.4">7.4.</a> <a href="#keyid" id="keyid">KEY-ID</a></h1>
<p id="rfc.section.7.4.p.1">key id is an identifier generated by the resource server. This value selects the appropriate keying material for decryption. This keying material is a symmetric or an asymmetric long-term key established between the resource server and the authorization server, as shown in <a href="#interactions">Figure 4</a> as AS-RS key. The establishment of this long-term key is outside the scope of this specification and discussed in Appendix A.2.3 of <a href="#I-D.ietf-oauth-v2-http-mac">[I-D.ietf-oauth-v2-http-mac]</a>.</p>
<h1 id="rfc.section.7.5"><a href="#rfc.section.7.5">7.5.</a> <a href="#algorithm" id="algorithm">MAC-ALGORITHM</a></h1>
<p id="rfc.section.7.5.p.1">Indicates the MAC algorithm. The MAC Algorithm ID field contains an IKEv2 Transform ID of Transform Type 3 <a href="#RFC4306">[RFC4306]</a>. All TURN implementations MUST support AUTH_HMAC_SHA1_160 (7) <a href="#RFC4595">[RFC4595]</a>.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#security" id="security">Security Considerations</a></h1>
<p id="rfc.section.8.p.1">When OAuth is used the interaction between the client and the authorization server requires Transport Layer Security (TLS) with a ciphersuite offering confidentiality protection. The session key MUST NOT be transmitted in clear since this would completely destroy the security benefits of the proposed scheme. Other security considerations are discussed in <a href="#I-D.ietf-oauth-v2-http-mac">[I-D.ietf-oauth-v2-http-mac]</a>.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#iana" id="iana">IANA Considerations</a></h1>
<p id="rfc.section.9.p.1">IANA is requested to add the following attributes to the <a href="#iana-stun">STUN attribute registry</a> <cite title="NONE">[iana-stun]</cite>, </p>

<ul>
  <li>THIRD-PARTY-AUTHORIZATION</li>
  <li>ACCESS-TOKEN</li>
  <li>TIMESTAMP</li>
  <li>KEY-ID</li>
  <li>MAC-ALGORITHM</li>
</ul>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> <a href="#ack" id="ack">Acknowledgements</a></h1>
<p id="rfc.section.10.p.1">Authors would like to thank Dan Wing, Pal Martinsen for comments and review.</p>
<h1 id="rfc.references"><a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-oauth-v2-http-mac">[I-D.ietf-oauth-v2-http-mac]</b>
      </td>
      <td class="top"><a>Richer, J.</a>, <a>Mills, W.</a>, <a>Tschofenig, H.</a> and <a>P. Hunt</a>, "<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-http-mac-04">OAuth 2.0 Message Authentication Code (MAC) Tokens</a>", Internet-Draft draft-ietf-oauth-v2-http-mac-04, July 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4306">[RFC4306]</b>
      </td>
      <td class="top"><a>Kaufman, C.</a>, "<a href="http://tools.ietf.org/html/rfc4306">Internet Key Exchange (IKEv2) Protocol</a>", RFC 4306, December 2005.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4595">[RFC4595]</b>
      </td>
      <td class="top"><a>Maino, F.</a> and <a>D. Black</a>, "<a href="http://tools.ietf.org/html/rfc4595">Use of IKEv2 in the Fibre Channel Security Association Management Protocol</a>", RFC 4595, July 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5389">[RFC5389]</b>
      </td>
      <td class="top"><a>Rosenberg, J.</a>, <a>Mahy, R.</a>, <a>Matthews, P.</a> and <a>D. Wing</a>, "<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>", RFC 5389, October 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6749">[RFC6749]</b>
      </td>
      <td class="top"><a>Hardt, D.</a>, "<a href="http://tools.ietf.org/html/rfc6749">The OAuth 2.0 Authorization Framework</a>", RFC 6749, October 2012.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="iana-stun">[iana-stun]</b>
      </td>
      <td class="top"><a>IANA, .</a>, "<a href="http://www.iana.org/assignments/stun-parameters/stun-pa rameters.xml">IANA: STUN Attributes</a>", April 2011.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-rtcweb-overview">[I-D.ietf-rtcweb-overview]</b>
      </td>
      <td class="top"><a>Alvestrand, H.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-rtcweb-overview-08">Overview: Real Time Protocols for Brower-based Applications</a>", Internet-Draft draft-ietf-rtcweb-overview-08, September 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-rtcweb-use-cases-and-requirements">[I-D.ietf-rtcweb-use-cases-and-requirements]</b>
      </td>
      <td class="top"><a>Holmberg, C.</a>, <a>Hakansson, S.</a> and <a>G. Eriksson</a>, "<a href="http://tools.ietf.org/html/draft-ietf-rtcweb-use-cases-and-requirements-12">Web Real-Time Communication Use-cases and Requirements</a>", Internet-Draft draft-ietf-rtcweb-use-cases-and-requirements-12, October 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.reddy-behave-turn-auth">[I-D.reddy-behave-turn-auth]</b>
      </td>
      <td class="top"><a>Reddy, T.</a>, <a>R, R.</a>, <a>Perumal, M.</a> and <a>A. Yegin</a>, "<a href="http://tools.ietf.org/html/draft-reddy-behave-turn-auth-04">Problems with STUN Authentication for TURN</a>", Internet-Draft draft-reddy-behave-turn-auth-04, September 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3261">[RFC3261]</b>
      </td>
      <td class="top"><a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5245">[RFC5245]</b>
      </td>
      <td class="top"><a>Rosenberg, J.</a>, "<a href="http://tools.ietf.org/html/rfc5245">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>", RFC 5245, April 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5766">[RFC5766]</b>
      </td>
      <td class="top"><a>Mahy, R.</a>, <a>Matthews, P.</a> and <a>J. Rosenberg</a>, "<a href="http://tools.ietf.org/html/rfc5766">Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)</a>", RFC 5766, April 2010.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC6819">[RFC6819]</b>
      </td>
      <td class="top"><a>Lodderstedt, T.</a>, <a>McGloin, M.</a> and <a>P. Hunt</a>, "<a href="http://tools.ietf.org/html/rfc6819">OAuth 2.0 Threat Model and Security Considerations</a>", RFC 6819, January 2013.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tirumaleswar Reddy</span> 
	  <span class="n hidden">
		<span class="family-name">Reddy</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span>Cessna Business Park, Varthur Hobli</span>
<span>Sarjapur Marathalli Outer Ring Road</span>

	  <span class="vcardline">
		<span class="locality">Bangalore</span>,  
		<span class="region">Karnataka</span> 
		<span class="code">560103</span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:tireddy@cisco.com">tireddy@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Prashanth Patil</span> 
	  <span class="n hidden">
		<span class="family-name">Patil</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Bangalore</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:praspati@cisco.com">praspati@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ram Mohan Ravindranath</span> 
	  <span class="n hidden">
		<span class="family-name">Ravindranath</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span>Cessna Business Park,</span>
<span>Kadabeesanahalli Village, Varthur Hobli,</span>
<span>Sarjapur-Marathahalli Outer Ring Road</span>

	  <span class="vcardline">
		<span class="locality">Bangalore</span>,  
		<span class="region">Karnataka</span> 
		<span class="code">560103</span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:rmohanr@cisco.com">rmohanr@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Justin Uberti</span> 
	  <span class="n hidden">
		<span class="family-name">Uberti</span>
	  </span>
	</span>
	<span class="org vcardline">Google</span>
	<span class="adr">
	  <span>747 6th Ave S</span>
<span>Kirkland, WA</span>

	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code">98033</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:justin@uberti.name">justin@uberti.name</a></span>

  </address>
</div>

</body>
</html>